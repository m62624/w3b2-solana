FROM node:18-slim

WORKDIR /app

RUN apt-get update && apt-get install -y jq netcat-openbsd git && \
    rm -rf /var/lib/apt/lists/* 

COPY examples/app/package*.json ./
RUN npm install google-protobuf

COPY proto/ /app/proto/
RUN npx grpc_tools_node_protoc \
    --js_out=import_style=commonjs,binary:./ \
    --grpc_out=grpc_js:./ \
    --proto_path=./proto \
    ./proto/gateway.proto ./proto/types.proto ./proto/protocols.proto

COPY examples/app/ /app/

CMD ["node", "solana/app.js"]
