syntax = "proto3";

package w3b2.protocol.gateway;
import "types.proto";

import "google/protobuf/empty.proto";

// ===================================================================
// == Service Definition: BridgeGatewayService (Non-Custodial)
// ===================================================================
/// The primary gRPC service for interacting with the W3B2 Bridge protocol.
///
/// This service follows a non-custodial, two-step "prepare-then-submit" flow
/// for all on-chain operations:
/// 1. The client calls a specific "Prepare" method (e.g., `PrepareUserDeposit`)
///    to request an unsigned transaction from the gateway.
/// 2. The client signs this transaction locally on their device, ensuring their
///    private key is never exposed.
/// 3. The client sends the signed transaction back using the generic
/// `SubmitTransaction` method.
service BridgeGatewayService {

  // ===================================================================
  // == Event Streaming RPCs
  // ===================================================================

  /// Subscribes to and streams all events for a specific UserProfile PDA.
  /// This is a server-streaming RPC. The client makes a single request with the
  /// PDA, and the server streams back all relevant historical (catch-up) and
  /// real-time (live) events. The stream is closed when the client disconnects.
  rpc ListenAsUser(ListenRequest) returns (stream EventStreamItem);

  /// Subscribes to and streams all categorized events for a specific Admin.
  /// This is a server-streaming RPC. The client makes a single request with the
  /// AdminProfile PDA, and the server streams back all relevant historical and
  /// real-time events.
  rpc ListenAsAdmin(ListenRequest) returns (stream EventStreamItem);

  /// Manually unsubscribes a client from an active event stream using its
  /// unique subscription ID.
  rpc Unsubscribe(UnsubscribeRequest) returns (google.protobuf.Empty);
}